---
title:  Day 13 of 100 Days of Devops
description: IPtables Installation And Configuration
author: winhtaikaung 
date: 2025-12-01 11:33:00 +0800
categories: [CS]
tags: [DevOps, Linux, 100-Days-Of-DevOps,ipTables,Firewall Rules]
pin: false
math: true
mermaid: true

---
We have one of our websites up and running on our Nautilus infrastructure in Stratos DC. Our security team has raised a concern that right now Apacheâ€™s port i.e 3002 is open for all since there is no firewall installed on these hosts. So we have decided to add some security layer for these hosts and after discussions and recommendations we have come up with the following requirements:



1. Install iptables and all its dependencies on each app host.


2. Block incoming port 3002 on all apps for everyone except for LBR host.


3. Make sure the rules remain, even after system reboot.

# Setting up
First of all for easy access to all servers I add my own key to all app servers 
```bash
thor@jumphost ~$ ssh-keygen -t rsa -b 2048 -f ~/.ssh/id_rsa -N ""
Generating public/private rsa key pair.
Your identification has been saved in /home/thor/.ssh/id_rsa
Your public key has been saved in /home/thor/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:G65wv0HsFsDiZnPGHL9hmajp7itNsUskAlko/6JD79U thor@jumphost.stratos.xfusioncorp.com
The key's randomart image is:
+---[RSA 2048]----+
| +.              |
|=    .           |
|o.  . +          |
|. o.o+ * o       |
| . +=o* S        |
| ..o=*.= *       |
|...=+o.EB        |
|o .o+o + .       |
| ..==.. o.       |
+----[SHA256]-----+
```

## listing IP Tables

`sudo iptables -L -n` -n help us to display network.

```bash
[banner@stapp03 ~]$ sudo iptables -L -n
Chain INPUT (policy ACCEPT)
target     prot opt source               destination         
ACCEPT     tcp  --  0.0.0.0/0        0.0.0.0/0            tcp dpt:3002

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination         
DOCKER-USER  all  --  0.0.0.0/0            0.0.0.0/0           
DOCKER-ISOLATION-STAGE-1  all  --  0.0.0.0/0            0.0.0.0/0           
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0            ctstate RELATED,ESTABLISHED
DOCKER     all  --  0.0.0.0/0            0.0.0.0/0           
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         

Chain DOCKER (1 references)
target     prot opt source               destination         

Chain DOCKER-ISOLATION-STAGE-1 (1 references)
target     prot opt source               destination         
DOCKER-ISOLATION-STAGE-2  all  --  0.0.0.0/0            0.0.0.0/0           
RETURN     all  --  0.0.0.0/0            0.0.0.0/0           

Chain DOCKER-ISOLATION-STAGE-2 (1 references)
target     prot opt source               destination         
DROP       all  --  0.0.0.0/0            0.0.0.0/0           
RETURN     all  --  0.0.0.0/0            0.0.0.0/0           

Chain DOCKER-USER (1 references)
target     prot opt source               destination         
RETURN     all  --  0.0.0.0/0            0.0.0.0/0     
```
As you can see the follwing line on ip table list which is the issue pointed by security team. So our plan is to allow Load Balancer to access the instance.

```
ACCEPT     tcp  --  0.0.0.0/0        0.0.0.0/0            tcp dpt:3002
```

## Allowing the port specific to Load Balancer(Do it in all appservers)

So we add ip tables of each app server and make sure to save to persist the changes
```bash
 sudo iptables -A INPUT -p tcp -s stlb01 --dport 3002 -j ACCEPT

 sudo service iptables save
```

then check the list again, now IP table is allowing however according to requirement we have to block the unknown access
```bash
[tony@stapp01 ~]$ sudo iptables -L -n

Chain INPUT (policy ACCEPT)
target     prot opt source               destination         
ACCEPT     tcp  --  172.16.238.14        0.0.0.0/0            tcp dpt:3002


Chain FORWARD (policy ACCEPT)
target     prot opt source               destination         
DOCKER-USER  all  --  0.0.0.0/0            0.0.0.0/0           
DOCKER-ISOLATION-STAGE-1  all  --  0.0.0.0/0            0.0.0.0/0           
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0            ctstate RELATED,ESTABLISHED
DOCKER     all  --  0.0.0.0/0            0.0.0.0/0           
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         

Chain DOCKER (1 references)
target     prot opt source               destination         

Chain DOCKER-ISOLATION-STAGE-1 (1 references)
target     prot opt source               destination         
DOCKER-ISOLATION-STAGE-2  all  --  0.0.0.0/0            0.0.0.0/0           
RETURN     all  --  0.0.0.0/0            0.0.0.0/0           

Chain DOCKER-ISOLATION-STAGE-2 (1 references)
target     prot opt source               destination         
DROP       all  --  0.0.0.0/0            0.0.0.0/0           
RETURN     all  --  0.0.0.0/0            0.0.0.0/0           

---------------
[banner@stapp03 ~]$ 
[banner@stapp03 ~]$ sudo service iptables save
iptables: Saving firewall rules to /etc/sysconfig/iptables: [  OK  ]
```
## Blocking Connection
```bash
sudo iptables -A INPUT -p tcp --dport 3002 -j DROP
sudo service iptables save
```

**ps** i did search some reference online about ip tables while doing exerciese.

after checking again Tada it is blocking all unknown ups from loadBalancer
```bash
[banner@stapp03 ~]$ sudo iptables -L -n
Chain INPUT (policy ACCEPT)
target     prot opt source               destination         
ACCEPT     tcp  --  172.16.238.14        0.0.0.0/0            tcp dpt:3002
DROP       tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:3002

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination         
DOCKER-USER  all  --  0.0.0.0/0            0.0.0.0/0           
DOCKER-ISOLATION-STAGE-1  all  --  0.0.0.0/0            0.0.0.0/0           
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0            ctstate RELATED,ESTABLISHED
DOCKER     all  --  0.0.0.0/0            0.0.0.0/0           
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         

Chain DOCKER (1 references)
target     prot opt source               destination         

Chain DOCKER-ISOLATION-STAGE-1 (1 references)
target     prot opt source               destination         
DOCKER-ISOLATION-STAGE-2  all  --  0.0.0.0/0            0.0.0.0/0           
RETURN     all  --  0.0.0.0/0            0.0.0.0/0           

Chain DOCKER-ISOLATION-STAGE-2 (1 references)
target     prot opt source               destination         
DROP       all  --  0.0.0.0/0            0.0.0.0/0           
RETURN     all  --  0.0.0.0/0            0.0.0.0/0           

Chain DOCKER-USER (1 references)
target     prot opt source               destination         
RETURN     all  --  0.0.0.0/0            0.0.0.0/0   
```

Thats all of today , Thx Bye!